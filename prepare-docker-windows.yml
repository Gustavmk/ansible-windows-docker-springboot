---

  - name: Get Windows Build Number
    win_file_version:
      path: C:\Windows\System32\hal.dll
    register: hal_dll_version_return

  - name: Fail, if Windows Build number doesn´t support Windows Docker Containers correctly
    fail:
      msg: "Windows Build Number {{hal_dll_version_return.win_file_version.product_version}} doesn´t support Windows Docker Container correctly ({{hal_dll_version_return.win_file_version.file_private_part}} is to small)"
    when: hal_dll_version_return.win_file_version.file_private_part|int < 206

  - name: Congratulations
    debug:
      msg: "With your Build Number {{hal_dll_version_return.win_file_version.product_version}} you have choosen a good basis for Windows Docker Containers!"

#  - name: Install Containers natively as Windows Feature   
#    win_shell: Enable-WindowsOptionalFeature -Online -FeatureName containers -All
#    ignore_errors: yes   

#  - name: Install Hyper-V as Windows Feature    
#    win_shell: Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V -All
#    ignore_errors: yes

#  - name: Reboot Machine to have Containers and Hyper-V take effect
#    win_reboot:

  - name: Install Docker via chocolatey
    win_chocolatey:
      name: docker

  - name: Register Docker as a Windows Service (if not already there)
    win_shell: "C:\\ProgramData\\chocolatey\\lib\\docker\\tools\\docker\\dockerd.exe --register-service"
    ignore_errors: yes

  - name: Start Docker as Windows Service
    win_shell: Start-Service Docker

  - name: Pull the small Windows Docker Base Image microsoft/nanoserver from hub.docker.com
    win_shell: docker pull microsoft/nanoserver  

  - name: Get the second (but 10GB big) Windows Docker Base Image microsoft/windowsservercore from hub.docker.com (you may grab a coffee now...)
    win_shell: docker pull microsoft/windowsservercore 

  - name: Install Sysinternals Utilities, so that we can observe the Docker processes with the help of the Process Monitor´s Process Tree
    win_chocolatey:
      name: sysinternals

